var RAplayer,playerBtn,muteBtn,context,analyser,canvas,ctx;function updateTrackInfo(){$.ajax({type:'POST',url:'http://janus.shoutca.st:8972/stats',data:{sid:1,json:1},dataType:'jsonp',success:function(data){document.getElementById('cover').setAttribute("value","nom");tempSong=$("#title .marquee p").text();currentSong=data.songtitle.split("-");if(currentSong.length>1){if(currentSong[1].charAt(0)===' ')currentSong[1]=currentSong[1].substr(1);if(currentSong[0].charAt(currentSong[0].length-1)===' ')currentSong[0]=currentSong[0].slice(0,-1)}else{temp=currentSong[0];currentSong[1]=temp;currentSong[0]="Desconocido"}
if(tempSong.localeCompare(currentSong[1])!=0){if(currentSong[0].localeCompare("Desconocido")!=0)updateCoverArt(currentSong[0],currentSong[1]);else $('#cover').attr('src','https://2.bp.blogspot.com/-yUnXHoN2gao/W3_YII0WO5I/AAAAAAAAAU8/G5nDTAPyF4c02WL_XEy33j6oYPuXBsfFACPcBGAYYCw/s1600/no_cover.jpg')}
titleMarquee=document.querySelector('#title .marquee p');artistMarquee=document.querySelector('#artist .marquee p');titleMarquee.textContent=currentSong[1];artistMarquee.textContent=currentSong[0];if(titleMarquee.clientWidth>=document.getElementById('title').clientWidth-20)titleMarquee.classList.add("animateMarquee");else titleMarquee.classList.remove("animateMarquee");if(artistMarquee.clientWidth>=document.getElementById('artist').clientWidth-20)artistMarquee.classList.add("animateMarquee");else artistMarquee.classList.remove("animateMarquee")}})}
function updateCoverArt(artist,track){$.ajax({url:'http://ws.audioscrobbler.com/2.0/',data:{method:'track.getInfo',api_key:'98717496b44bab3367cac9903dbce3e9',artist:artist,track:track,format:'json'},dataType:'jsonp',success:function(data){if(data.error===6||(typeof data.track.album==="undefined")||data.track.album.image[3]['#text']==="")$('#cover').attr('src','https://2.bp.blogspot.com/-yUnXHoN2gao/W3_YII0WO5I/AAAAAAAAAU8/G5nDTAPyF4c02WL_XEy33j6oYPuXBsfFACPcBGAYYCw/s1600/no_cover.jpg');else{document.getElementById('cover').setAttribute("value","mod");$('#cover').attr('src',data.track.album.image[3]['#text'])}}});document.getElementById('cover').onload=function(){if(document.getElementById('cover').getAttribute("value")=="nom"){$.ajax({url:'http://itunes.apple.com/search',data:{term:artist+' '+track,media:'music'},dataType:'jsonp',success:function(json){if(json.resultCount===0)$('#cover').attr('src','https://2.bp.blogspot.com/-yUnXHoN2gao/W3_YII0WO5I/AAAAAAAAAU8/G5nDTAPyF4c02WL_XEy33j6oYPuXBsfFACPcBGAYYCw/s1600/no_cover.jpg');else $('#cover').attr('src',json.results[0].artworkUrl100.replace("100x100","300x300"))}})}}}
function initDokiPlayer(){RAplayer=document.getElementById('player'),playBtn=document.getElementById('playBtn'),muteBtn=document.getElementById('muteBtn');playBtn.addEventListener("click",function(){if(playBtn.getAttribute("value")=="play")pauseP();else playP()});muteBtn.addEventListener("click",function(){if(muteBtn.getAttribute("value")=="sound"){RAplayer.muted=!0;muteBtn.setAttribute("value","mute");muteBtn.classList.remove("icon-volume");muteBtn.classList.add("icon-mute")}else{RAplayer.muted=!1;muteBtn.setAttribute("value","sound");muteBtn.classList.remove("icon-mute");muteBtn.classList.add("icon-volume")}});RAplayer.volume=document.getElementById("volume").value;document.getElementById("volume").onchange=function(e){RAplayer.volume=e.target.value}}
function playP(){RAplayer.load();RAplayer.play();playBtn.setAttribute("value","play");playBtn.classList.remove("icon-play");playBtn.classList.add("icon-stop");document.getElementById('cover').style.animationPlayState="running"}
function pauseP(){RAplayer.pause();playBtn.setAttribute("value","stop");playBtn.classList.remove("icon-stop");playBtn.classList.add("icon-play");document.getElementById('cover').style.animationPlayState="paused"}
function initVisualizer(){try{let ctxt=window.AudioContext||window.webkitAudioContext;if(ctxt){context=new ctxt()}}catch(e){console.log(e)}
analyser=context.createAnalyser();canvas=document.getElementById('frequency_render');ctx=canvas.getContext('2d');source=context.createMediaElementSource(RAplayer);source.connect(analyser);analyser.connect(context.destination);frameLooper()}
function frameLooper(){window.requestAnimationFrame(frameLooper);fbc_array=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(fbc_array);ctx.clearRect(0,0,canvas.width,canvas.height);ctx.strokeStyle="#bf0411";ctx.beginPath();ctx.moveTo(canvas.width,(canvas.height-(canvas.height/4))/2);for(var i=0;i<Math.floor(fbc_array.length/3.2);i++){bar_x=canvas.width-i;bar_width=1;if(i%2==0)bar_height=(-(fbc_array[i]/6.5))+(canvas.height-(canvas.height/4));else bar_height=(fbc_array[i]/6.5)+(canvas.height-(canvas.height/4));ctx.lineTo(bar_x,bar_height)}
ctx.stroke()}